import{a as p,t as v,c as tt}from"../chunks/DldQStsR.js";import{i as et}from"../chunks/CATt0WfG.js";import{p as at,o as rt,a as ot,f as k,c as st,b as s,g as a,s as h,e as o,r,h as lt,i as nt,j as C}from"../chunks/FJRCtc8Y.js";import{e as u,s as f}from"../chunks/CuXJoPns.js";import{i as F}from"../chunks/B2zXuP2w.js";import{e as ct,f as dt}from"../chunks/DpdfpHoe.js";import{c as it,C as pt}from"../chunks/DvOSdxAZ.js";import{s as ht}from"../chunks/CyGVOWoH.js";var ut=v('<button class="bg-gray-600 text-white px-3 py-1 rounded hover:bg-gray-700">Stop</button> <button class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">Console</button>',1),bt=v('<button class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700">Start</button>'),ft=v('<tr class="border-b"><td class="py-2"> </td><td class="py-2"> </td><td class="py-2"> </td><td class="py-2"><span> </span></td><td class="py-2 space-x-2"><!> <button class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700">Delete</button></td></tr>'),vt=v('<div class="bg-white rounded-lg shadow p-6"><div class="mb-4"><button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Create VM</button></div> <table class="w-full"><thead><tr class="border-b"><th class="text-left py-2">Name</th><th class="text-left py-2">Cores</th><th class="text-left py-2">Memory</th><th class="text-left py-2">State</th><th class="text-left py-2">Actions</th></tr></thead><tbody></tbody></table></div> <!>',1);function St(P,q){at(q,!1);let D=C([]),y=C(!1),j,l=C(new Set);async function d(){try{const e=await fetch("/api/vms");h(D,await e.json())}catch(e){console.error("Failed to load VMs:",e)}}async function B(e){try{await fetch(`/api/vms/${e}/start`,{method:"POST"}),await d()}catch(t){console.error("Failed to start VM:",t)}}async function L(e){try{a(l).add(e),h(l,a(l)),await fetch(`/api/vms/${e}/stop`,{method:"POST"}),await d()}catch(t){console.error("Failed to stop VM:",t)}finally{a(l).delete(e),h(l,a(l))}}async function z(e){if(confirm(`Are you sure you want to delete ${e}?`))try{await fetch(`/api/vms/${e}`,{method:"DELETE"}),await d()}catch(t){console.error("Failed to delete VM:",t)}}async function G(e){try{const t=await fetch(`/api/vms/${e}/vnc`),{port:i}=await t.json();window.open(`http://${window.location.hostname}:${i}/vnc.html`,"_blank")}catch(t){console.error("Failed to open VNC:",t)}}rt(()=>{d(),j=setInterval(d,5e3)}),ot(()=>{clearInterval(j)}),et();var E=vt(),m=k(E),_=o(m),H=o(_);r(_);var N=s(_,2),T=s(o(N));ct(T,5,()=>a(D),e=>e.name,(e,t)=>{var i=ft(),w=o(i),Q=o(w,!0);r(w);var g=s(w),R=o(g,!0);r(g);var x=s(g),U=o(x);r(x);var M=s(x),V=o(M),W=o(V,!0);r(V),r(M);var A=s(M),I=o(A);{var X=n=>{var c=ut(),b=k(c),S=s(b,2);u("click",b,()=>L(a(t).name)),u("click",S,()=>G(a(t).name)),p(n,c)},Y=n=>{var c=tt(),b=k(c);{var S=$=>{var O=bt();u("click",O,()=>B(a(t).name)),p($,O)};F(b,$=>{a(t).state==="stopped"&&$(S)},!0)}p(n,c)};F(I,n=>{a(t).state==="running"?n(X):n(Y,!1)})}var Z=s(I,2);r(A),r(i),lt((n,c)=>{f(Q,a(t).name),f(R,a(t).cores),f(U,`${a(t).memory??""} MB`),ht(V,it(n)),f(W,c)},[()=>a(l).has(a(t).name)?"px-2 py-1 rounded-full bg-yellow-100 text-yellow-800":dt(a(t).state),()=>a(l).has(a(t).name)?"stopping":a(t).state],nt),u("click",Z,()=>z(a(t).name)),p(e,i)}),r(T),r(N),r(m);var J=s(m,2);{var K=e=>{pt(e,{$$events:{close:()=>h(y,!1),created:d}})};F(J,e=>{a(y)&&e(K)})}u("click",H,()=>h(y,!0)),p(P,E),st()}export{St as component};
